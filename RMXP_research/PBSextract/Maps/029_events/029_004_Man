[EVENT]
xy=[6, 2]
graphic="NPC 01"

[PAGE]



if s:pbIsWeekday(1,2,4,6)
  # Today is Tuesday, Thursday or Saturday, and the
  # Bug Contest is on.  The weekday name is stored in
  # variable 1.
  if s:pbBugContestState.pbContestHeld?
    Show Text "\\bWe hope you'll take part in a Bug-Catching Contest in the future!"
    End Execution
  
  Show Text "\\bToday's \\v[1]."
  Show Text "\\bThat means the Bug-Catching Contest is on today."
  Show Text "\\bThe rules are simple."
  Show Text "\\bUsing one of your Pokémon, catch a Bug-type Pokémon to be judged."
  Show Text "\\bWould you like to give it a try?"
  Show Choices choices=['Yes', 'No'], default=2
  When 'Yes'
    if s:pbBoxesFull?
      Show Text "\\bSorry, your PC boxes are full."
      End Execution
    
    Show Text "\\bYou are only allowed to take 1 Pokémon into the Contest."
    Show Text "\\bPlease choose which Pokémon you want to enter with."
    # Opens a screen for choosing a Pokémon except those
    # with 0 HP or that are eggs. The index is stored in
    # variable 1, the Pokémon's name in variable 2.
    s:pbChooseAblePokemon(1,2)
    if :TempPokemonChoice < 0
      # Cancelled choosing a Pokémon.
      Show Text "\\bOK. We hope you'll take part in the future."
      End Execution
    Else
      Show Text "\\bYou will be entering with \\v[2], then."
      Show Text "\\bWe'll hold your other Pokémon while you compete."
      Show Text "\\PN's Pokémon were left with the Contest Helper.\\se[Pkmn exp full]\\wtnp[20]"
      Show Text "\\bHere are the Sport Balls for the Contest."
      Show Text "\\PN received 20 Sport Balls.\\me[Item get]\\wtnp[20]"
      Show Text "\\bThe person who gets the strongest bug Pokémon is the winner."
      Show Text "\\bYou have 20 minutes."
      Show Text "\\bIf you run out of Sport Balls, you're done."
      Show Text "\\bYou can keep the last Pokémon you catch as your own."
      Show Text "\\bGo out and catch the strongest Bug-type Pokémon you can find!"
      # Setting the map, X and Y where the Contest is
      # judged; setting the map used for determining the
      # Pokemon caught by contestants; setting the index of
      # the Pokemon selected by the player; and starting the
      # contest with 20 Sport Balls.
      s:pbBugContestState.pbSetJudgingPoint(30,5,6) pbBugContestState.pbSetReception(29,30) pbBugContestState.pbSetContestMap(28) pbBugContestState.pbSetPokemon(pbGet(1)) pbBugContestState.pbStart(20)"
      Set Move Route :player
        Set property=through value=:ON
        Step S
        Step E
        Step E
        Step E
        Step E
        Step E
        Set property=opacity value={opa}
        Set property=through value=:OFF
      
      Play SE="Door exit", volume=80, pitch=100
      Fadeout color=Black, ms=300
      Wait ms=400
      Set Move Route :player
        Set property=opacity value={opa}
      Transfer Player map=28, x=8, y=24, direction="K", fading="NoFading"
      Fadein ms=300
      End Execution
    
  When 'No'
    Show Text "\\bOK. We hope you'll take part in the future."
Else
  # Today is not a Contest day.
  Show Text "\\bWe hold contests regularly in the Park. You should give it a shot."
[end]


[PAGE]
trigger=onAutorun
s:pbBugContestUndecided? == :ON

# Event page called when the contest is still in
# progress.
Wait ms=1000
Show Text "\\bYou still have some time left. Do you want to finish now?"
Show Choices choices=['Yes', 'No'], default=2
When 'Yes'
  Show Text "\\bOK. Please wait in the pavillion for the announcement of the winners."
  s:pbBugContestState.pbStartJudging
  End Execution
When 'No'
  Show Text "\\bOK. Please go back outside and finish up."
  Set Move Route :player
    Turn E
    Wait s=4
    Set property=opacity value={opa}
  
  Play SE="Door exit", volume=80, pitch=100
  Fadeout color=Black, ms=300
  Wait ms=400
  Set Move Route :player
    Set property=opacity value={opa}
  Transfer Player map=28, x=8, y=24, direction="K", fading="NoFading"
  Fadein ms=300
  End Execution
[end]

