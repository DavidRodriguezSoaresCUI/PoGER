[EVENT]
xy=[16, 3]
graphic="NPC 23"

[PAGE]



Show Text "\\rWelcome to the Battle Tower."
Show Text "\\rWould you like to participate in a double battle?"
Show Choices choices=['Yes', 'No'], default=2
When 'Yes'
  Show Text "\\rDo you want to take the Level 50 challenge, or the Open Level challenge?"
  Show Choices choices=['Level 50', 'Open Level', 'Cancel'], default=3
  When 'Level 50'
    s:pbBattleChallenge.set("towerdouble",7, pbBattleTowerRules(true,false))"
  When 'Open Level'
    s:pbBattleChallenge.set("towerdoubleopen",7, pbBattleTowerRules(true,true))"
  When 'Cancel'
    Goto End
  # Has 3 or more eligible Pokemon level 100 or less?
  if s:!pbHasEligible?(3,100)
    Show Text "\\rSorry, you can't participate. You need three different Pokémon to enter."
    Show Text "\\rThey must be of a different species and hold different items."
    Show Text "\\rCertain exotic species, as well as eggs, are ineligible."
    Goto End
  
  Show Text "\\rPlease choose the three Pokémon that will enter."
  if s:!pbEntryScreen(3,100)
    Goto End
  
  if s:pbSaveScreen
    Show Text "\\rPlease come this way."
    # Starting challenge type 0 (7 rounds)
    s:pbBattleChallenge.start(0,7)
    Set Move Route :self
      Set property=through value=:ON
      Wait s=4
      Turn N
      Step N
      Set property=through value=:OFF
    Set Move Route :player
      Set property=through value=:ON
      Wait s=4
      Turn N
      Step N
      Set property=through value=:OFF
    
    Set Move Route 9
      Play SE="Door enter", volume=100, pitch=100
      Wait s=2
      Turn W
      Wait s=2
      Turn E
      Wait s=2
      Turn N
      Wait s=2
    
    Set Move Route :self
      Set property=through value=:ON
      Step N
      Set property=opacity value={opa}
      Set property=through value=:OFF
    Set Move Route :player
      Set property=through value=:ON
      Wait s=4
      Step N
      Step N
      Set property=opacity value={opa}
      Set property=through value=:OFF
    
    Set property=transparent value=:ON
    Set Move Route 9
      Wait s=2
      Turn E
      Wait s=2
      Turn W
      Wait s=2
      Turn S
      Wait s=2
    
    Fadeout color=Black, ms=300
    Wait ms=400
    Transfer Player map=56, x=0, y=6, direction="E", fading="NoFading"
    Fadein ms=300
  Else
    Goto End
  
When 'No'
  Label End
  Show Text "\\rCome back another time."
  s:pbBattleChallenge.pbCancel
  End Execution
[end]


[PAGE]
trigger=onAutorun
s:pbInChallenge? == :ON

# If Won
if s:pbBattleChallenge.decision==1
  Show Text "\\rCongratulations for winning."
  Show Text "\\rPlease take this prize."
  if s:!Kernel.pbReceiveItem(:RARECANDY)
    Show Text "\\rYou have no room for it. At least you won, though."
  
  if s:$PokemonTemp.lastbattle!=nil
    Show Text "\\rWould you like to record your last battle?"
    Show Choices choices=['Yes', 'No'], default=2
    When 'Yes'
      s:pbRecordLastBattle
      Show Text "\\se[Pkmn exp full]The battle was recorded."
    When 'No'
  
  Show Text "Your results will be recorded.\\wtnp[15]"
  s:pbBattleChallenge.pbEnd
  Show Text "\\rCome back another time."
  End Execution
# If Lost or Forfeited
if s:pbBattleChallenge.decision==2
  Show Text "\\rThanks for playing."
  if s:$PokemonTemp.lastbattle!=nil
    Show Text "\\rWould you like to record your last battle?"
    Show Choices choices=['Yes', 'No'], default=2
    When 'Yes'
      s:pbRecordLastBattle
      Show Text "\\se[Pkmn exp full]The battle was recorded."
    When 'No'
  
  Show Text "Your results will be recorded.\\wtnp[15]"
  s:pbBattleChallenge.pbEnd
  Show Text "\\rCome back another time."
  End Execution
if s:pbBattleChallenge.pbResting?
  Show Text "\\rWe've been waiting for you. Please come this way."
  s:pbBattleChallenge.pbGoOn
  Set Move Route :self
    Set property=through value=:ON
    Wait s=4
    Turn N
    Step N
    Set property=through value=:OFF
  Set Move Route :player
    Set property=through value=:ON
    Wait s=4
    Turn N
    Step N
    Set property=through value=:OFF
  
  Set Move Route 9
    Play SE="Door enter", volume=100, pitch=100
    Wait s=2
    Turn W
    Wait s=2
    Turn E
    Wait s=2
    Turn N
    Wait s=2
  
  Set Move Route :self
    Set property=through value=:ON
    Step N
    Set property=opacity value={opa}
    Set property=through value=:OFF
  Set Move Route :player
    Set property=through value=:ON
    Wait s=4
    Step N
    Step N
    Set property=opacity value={opa}
    Set property=through value=:OFF
  
  Set property=transparent value=:ON
  Set Move Route 9
    Wait s=2
    Turn E
    Wait s=2
    Turn W
    Wait s=2
    Turn S
    Wait s=2
  
  Fadeout color=Black, ms=300
  Wait ms=400
  Set property=transparent value=:OFF
  Transfer Player map=56, x=0, y=6, direction="E", fading="NoFading"
  Fadein ms=300
Else
  Show Text "\\rExcuse me, but you didn't save before finishing your challenge last time."
  Show Text "\\rSorry, but your challenge has been canceled."
  s:pbBattleChallenge.pbEnd
[end]

