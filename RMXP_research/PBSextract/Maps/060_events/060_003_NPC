[EVENT]
xy=[5, 3]
graphic=trchar031

[PAGE]



Show Text "\\bWelcome to the Battle Arena."
Show Text "\\bWould you like to participate in a battle?"
Show Choices choices=['Yes', 'No'], default=2
When 'Yes'
  Show Text "\\bDo you want to take the Level 50 challenge, or the Open Level challenge?"
  Show Choices choices=['Level 50', 'Open Level', 'Cancel'], default=3
  When 'Level 50'
    s:pbBattleChallenge.set("arena",7, pbBattleArenaRules(false))"
  When 'Open Level'
    s:pbBattleChallenge.set("arenaopen",7, pbBattleArenaRules(true))"
  When 'Cancel'
    Goto End
  # Has 3 or more eligible Pokemon level 100 or less?
  if s:!pbHasEligible?(3,100)
    Show Text "\\bSorry, you can't participate. You need three different Pokémon to enter."
    Show Text "\\bThey must be of a different species and hold different items."
    Show Text "\\bCertain exotic species, as well as eggs, are ineligible."
    Goto End
  
  Show Text "\\bPlease choose the three Pokémon that will enter."
  if s:!pbEntryScreen(3,100)
    Goto End
  
  if s:pbSaveScreen
    Show Text "\\bPlease come this way."
    s:pbBattleChallenge.start
    Set Move Route :self
      Set property=through value=:ON
      Wait s=4
      Turn N
      Step N
      Step N
      Set property=opacity value={opa}
      Set property=through value=:OFF
    Set Move Route :player
      Set property=through value=:ON
      Wait s=4
      Turn N
      Step N
      Step N
      Step N
      Set property=opacity value={opa}
      Set property=through value=:OFF
    
    Play SE="Door exit", volume=80, pitch=100
    Fadeout color=Black, ms=300
    Wait ms=400
    Transfer Player map=61, x=0, y=5, direction="E", fading="NoFading"
    Fadein ms=300
  Else
    Goto End
  
When 'No'
  Label End
  Show Text "\\bCome back another time."
  s:pbBattleChallenge.pbCancel
  End Execution
[end]


[PAGE]
trigger=onAutorun
s:pbInChallenge? == :ON

# If Won
if s:pbBattleChallenge.decision==1
  Show Text "\\bCongratulations for winning."
  Show Text "\\bPlease take this prize."
  if s:!Kernel.pbReceiveItem(:RARECANDY)
    Show Text "\\bYou have no room for it. At least you won, though."
  
  if s:$PokemonTemp.lastbattle!=nil
    Show Text "\\bWould you like to record your last battle?"
    Show Choices choices=['Yes', 'No'], default=2
    When 'Yes'
      s:pbRecordLastBattle
      Show Text "\\se[Pkmn exp full]The battle was recorded."
    When 'No'
  
  Show Text "Your results will be recorded.\\wtnp[15]"
  s:pbBattleChallenge.pbEnd
  Show Text "\\bCome back another time."
  End Execution
# If Lost or Forfeited
if s:pbBattleChallenge.decision==2
  Show Text "\\bThanks for playing."
  if s:$PokemonTemp.lastbattle!=nil
    Show Text "\\bWould you like to record your last battle?"
    Show Choices choices=['Yes', 'No'], default=2
    When 'Yes'
      s:pbRecordLastBattle
      Show Text "\\se[Pkmn exp full]The battle was recorded."
    When 'No'
  
  Show Text "Your results will be recorded.\\wtnp[15]"
  s:pbBattleChallenge.pbEnd
  Show Text "\\bCome back another time."
  End Execution
if s:pbBattleChallenge.pbResting?
  Show Text "\\bWe've been waiting for you. Please come this way."
  s:pbBattleChallenge.pbGoOn
  Set Move Route :self
    Set property=through value=:ON
    Wait s=4
    Turn N
    Step N
    Step N
    Set property=opacity value={opa}
    Set property=through value=:OFF
  Set Move Route :player
    Set property=through value=:ON
    Wait s=4
    Turn N
    Step N
    Step N
    Step N
    Set property=opacity value={opa}
    Set property=through value=:OFF
  
  Play SE="Door exit", volume=80, pitch=100
  Fadeout color=Black, ms=300
  Wait ms=400
  Transfer Player map=61, x=0, y=5, direction="E", fading="NoFading"
  Fadein ms=300
Else
  Show Text "\\bExcuse me, but you didn't save before finishing your challenge last time."
  Show Text "\\bSorry, but your challenge has been canceled."
  s:pbBattleChallenge.pbEnd
[end]

