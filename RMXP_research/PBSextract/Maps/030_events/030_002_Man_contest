[EVENT]
xy=[5, 4]


[PAGE]
graphic="NPC 01"


if s:pbIsWeekday(1,2,4,6)
  # Today is Tuesday, Thursday or Saturday, and the
  # Bug Contest is on.  The weekday name is stored in
  # variable 1.
  if s:pbBugContestState.pbContestHeld?
    Show Text "\\bWe hope you'll take part in a Bug-Catching Contest in the future!"
    End Execution
  
  Show Text "\\bToday's \\v[1]."
  Show Text "\\bThat means the Bug-Catching Contest is on today."
  Show Text "\\bThe rules are simple."
  Show Text "\\bUsing one of your Pokémon, catch a Bug-type Pokémon to be judged."
  Show Text "\\bWould you like to give it a try?"
  Show Choices choices=['Yes', 'No'], default=2
  When 'Yes'
    if s:pbBoxesFull?
      Show Text "\\bSorry, your PC boxes are full."
      End Execution
    
    Show Text "\\bYou are only allowed to take 1 Pokémon into the Contest."
    Show Text "\\bPlease choose which Pokémon you want to enter with."
    # Opens a screen for choosing a Pokémon except those
    # with 0 HP or that are eggs. The index is stored in
    # variable 1, the Pokémon's name in variable 2.
    s:pbChooseAblePokemon(1,2)
    if :TempPokemonChoice < 0
      # Cancelled choosing a Pokémon.
      Show Text "\\bOK.  We hope you'll take part in the future."
      End Execution
    Else
      Show Text "\\bYou will be entering with \\v[2], then."
      Show Text "\\bWe'll hold your other Pokémon while you compete."
      Show Text "\\PN's Pokémon were left with the Contest Helper.\\se[Pkmn exp full]\\wtnp[20]"
      Show Text "\\bHere are the Sport Balls for the Contest."
      Show Text "\\PN received 20 Sport Balls.\\me[Item get]\\wtnp[20]"
      Show Text "\\bThe person who gets the strongest bug Pokémon is the winner."
      Show Text "\\bYou have 20 minutes."
      Show Text "\\bIf you run out of Sport Balls, you're done."
      Show Text "\\bYou can keep the last Pokémon you catch as your own."
      Show Text "\\bGo out and catch the strongest Bug-type Pokémon you can find!"
      # Setting the map, X and Y where the Contest is
      # judged; setting the map used for determining the
      # Pokemon caught by contestants; setting the index of
      # the Pokemon selected by the player; and starting the
      # contest with 20 Sport Balls.
      s:pbBugContestState.pbSetJudgingPoint(30,5,6) pbBugContestState.pbSetReception(29,30) pbBugContestState.pbSetContestMap(28) pbBugContestState.pbSetPokemon(pbGet(1)) pbBugContestState.pbStart(20)"
      if s:eventDirection(:player) == N
        Set Move Route :player
          Set property=through value=:ON
          Step S
          Step S
          Step S
          Set property=opacity value={opa}
          Set property=through value=:OFF
      Else
        if s:eventDirection(:player) == W
          Set Move Route :player
            Set property=through value=:ON
            Step S
            Step W
            Step S
            Step S
            Step S
            Set property=opacity value={opa}
            Set property=through value=:OFF
        Else
          Set Move Route :player
            Set property=through value=:ON
            Step S
            Step E
            Step S
            Step S
            Step S
            Set property=opacity value={opa}
            Set property=through value=:OFF
        
      
      
      Play SE="Door exit", volume=80, pitch=100
      Fadeout color=Black, ms=300
      Wait ms=400
      Set Move Route :player
        Set property=opacity value={opa}
      Transfer Player map=28, x=26, y=6, direction="K", fading="NoFading"
      Fadein ms=300
      End Execution
    
  When 'No'
    Show Text "\\bOK. We hope you'll take part in the future."
Else
  # Today is not a Contest day.
  Show Text "\\bWe hold contests regularly in the Park. You should give it a shot."
[end]


[PAGE]

s:isNotWeekday == :ON

[end]


[PAGE]
trigger=onAutorun
graphic="NPC 01"
s:pbBugContestUndecided? == :ON

# Event page called when the contest is still in
# progress.
Wait ms=1000
Show Text "\\bYou still have some time left. Do you want to finish now?"
Show Choices choices=['Yes', 'No'], default=2
When 'Yes'
  Show Text "\\bPlease wait here for the announcement of the winners."
  s:pbBugContestState.pbStartJudging
When 'No'
  Show Text "\\bOK. Please go back outside and finish up."
  Set Move Route :player
    Turn S
    Wait s=4
    Set property=opacity value={opa}
  
  Play SE="Door exit", volume=80, pitch=100
  Fadeout color=Black, ms=300
  Wait ms=400
  Set Move Route :player
    Set property=opacity value={opa}
  Transfer Player map=28, x=26, y=6, direction="K", fading="NoFading"
  Fadein ms=300
[end]


[PAGE]
trigger=onAutorun
graphic="NPC 01"
s:pbBugContestDecided? == :ON

Show Text "\\bWe will now judge the Pokémon you've caught."
Show Text "......\\wt[10]\\n......"
Show Text "\\bWe have chosen the winners!\\nAre you ready for this?"
s:pbBugContestState.pbGetPlaceInfo(2)
Show Text "\\bPlacing third is \\v[1], who caught a writhing \\v[2]!"
Show Text "\\bThe score was \\v[3] points!"
s:pbBugContestState.pbGetPlaceInfo(1)
Show Text "\\bPlacing second is \\v[1], who caught a wriggling \\v[2]!"
Show Text "\\bThe score was \\v[3] points!"
s:pbBugContestState.pbGetPlaceInfo(0)
Show Text "\\bThis Bug-Catching Contest winner is..."
Show Text "\\b\\v[1], who caught a whopping \\v[2]!"
Show Text "\\bThe score was \\v[3] points!"
if s:pbBugContestState.place==0
  if :HasNationalDex == :ON
    s:arr=[:FIRESTONE,:THUNDERSTONE, :WATERSTONE,:LEAFSTONE, :MOONSTONE,:SUNSTONE, :DUSKSTONE,:DAWNSTONE, :SHINYSTONE,:OVALSTONE] item=arr[rand(arr.length)] pbSet(1,getID(PBItems,item)) pbSet(3,PBItems.getName(pbGet(1)))"
    Show Text "\\b\\PN, the First Place finisher, wins the \\v[3]!"
    s:Kernel.pbReceiveItem(pbGet(1))
  Else
    Show Text "\\b\\PN, the First Place finisher, wins the Sun Stone!"
    s:Kernel.pbReceiveItem(:SUNSTONE)
  
if s:pbBugContestState.place==1
  Show Text "\\b\\PN, the Second Place finisher, wins the Everstone!"
  s:Kernel.pbReceiveItem(:EVERSTONE)
if s:pbBugContestState.place==2
  Show Text "\\b\\PN, the Third Place finisher, wins the Sitrus Berry!"
  s:Kernel.pbReceiveItem(:SITRUSBERRY)
if s:pbBugContestState.place==3
  Show Text "\\bEveryone else gets a Shed Shell as a consolation prize!"
  s:Kernel.pbReceiveItem(:SHEDSHELL)
Show Text "\\bWe'll return the Pokémon we kept for you. Here you go!\\se[Pkmn exp full]"
Show Text "\\bWe hope you'll take part in a Bug-Catching Contest in the future!"
s:pbBugContestState.pbEnd
s:setTempSwitchOn("A")
[end]


[PAGE]
graphic="NPC 01"
s:isSSon("A") == :ON

Show Text "\\bWe hope you'll take part in a Bug-Catching Contest in the future!"
[end]

